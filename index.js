(() => {
    const EXTENSION_NAME = "ST-Ko-Localizer";
    if (globalThis.__stKoUiLocalizerLoaded) return;
    globalThis.__stKoUiLocalizerLoaded = true;

    // Static dictionary only
    const EXACT_MAP = new Map([
        [
            "- “content-visibility” 是浏览器的 CSS 性能优化：离开视口的消息会跳过布局/绘制，聊天很长时更流畅；主要在 Chromium / 酒馆桌面端有效，若出现显示/滚动异常请关闭。",
            '- "content-visibility"는 브라우저 CSS 성능 최적화 옵션입니다. 화면 밖의 메시지는 레이아웃/그리기를 생략하여 긴 채팅도 부드럽게 만듭니다. 주로 Chromium/Tavern 데스크톱에서 효과적입니다. 표시/스크롤 오류가 발생하면 끄세요.',
        ],
        [
            "- “HTML 未变”通过比对前端代码块（",
            '- 프론트엔드 코드 블록을 비교하여 "HTML 변경 없음"(',
        ],
        [
            "- “加载更多每批”：把插入旧消息拆成多帧，减少卡顿。",
            '- "배치당 추가 로드": 끊김 현상을 줄이기 위해 이전 메시지를 불러올 때 여러 프레임으로 나누어 처리합니다.',
        ],
        [
            "- “加载更多每批”会把顶部“Show more messages”改为分帧分批插入，减少冻结；按钮仍可点击作为备用。",
            '- "배치당 추가 로드"는 상단의 "Show more messages"를 프레임 단위로 나누어 처리해 프리징을 줄입니다. 버튼은 여전히 수동 조작용으로 클릭 가능합니다.',
        ],
        [
            "- “禁用代码块高亮”会屏蔽",
            '- "코드 블록 하이라이팅 비활성화"는 다음을 차단합니다: ',
        ],
        [
            "- “禁用代码块高亮”会屏蔽 hljs.highlightElement ，代码块仍可显示/复制。",
            '- "코드 블록 하이라이팅 비활성화"는 hljs.highlightElement를 차단합니다. 코드 블록은 여전히 표시/복사할 수 있습니다.',
        ],
        [
            "- “防误触左右滑动切换”：用于解决手机竖向滚动时轻微横向偏移导致误切分支。",
            '- "좌우 스와이프 오작동 방지": 모바일에서 세로 스크롤 중 약간의 가로 움직임으로 인해 채팅 분기가 의도치 않게 전환되는 문제를 방지합니다.',
        ],
        [
            "- “方向锁倍率 dx/dy ”（默认 1.8）：要求横向位移/纵向位移 ≥ 该倍率才算横滑。调大更严格更不易误触；调小更容易触发但更容易在斜滑/滚动时误判。",
            '- "방향 잠금 배율 dx/dy"(기본값 1.8): 가로 변위/세로 변위 ≥ 이 배율일 때만 가로 스와이프로 인식합니다. 값을 높이면 엄격해져 오작동이 줄어들고, 낮추면 작동은 쉽지만 스크롤 중 오판할 수 있습니다.',
        ],
        [
            "- “方向锁倍率(dx/dy)”（默认 1.8）：要求横向位移/纵向位移 ≥ 该倍率才算横滑。调大更严格更不易误触；调小更容易触发但更容易在斜滑/滚动时误判。",
            '- "방향 잠금 배율(dx/dy)"(기본값 1.8): 가로 변위/세로 변위 ≥ 이 배율일 때만 가로 스와이프로 인식합니다. 값을 높이면 엄격해져 오작동이 줄어들고, 낮추면 작동은 쉽지만 스크롤 중 오판할 수 있습니다.',
        ],
        [
            "- “首屏渲染条数”通过修改",
            '- "첫 화면 렌더링 개수"는 다음을 수정하여 적용됩니다: ',
        ],
        [
            "- “首屏渲染条数”通过修改 power_user.chat_truncation 生效。",
            '- "첫 화면 렌더링 개수"는 power_user.chat_truncation 값을 수정하여 적용됩니다.',
        ],
        [
            "- “隐藏代码块”：不直接显示",
            '- "코드 블록 숨기기": 직접 표시하지 않음',
        ],
        [
            "- “隐藏代码块”：会显示占位符；点击占位符可展开原代码块。",
            '- "코드 블록 숨기기": 자리 표시자(Placeholder)를 표시합니다. 클릭하면 원본 코드 블록이 펼쳐집니다.',
        ],
        [
            "- “提前无感预加载”：上滑接近顶部（提前触发阈值内）会自动分批加载，无需点击。关闭后不会提前加载。",
            '- "이전 메시지 자동 로드": 상단에 가까워지면(임계값 이내) 버튼 클릭 없이 자동으로 이전 메시지를 로드합니다. 끄면 자동 로드되지 않습니다.',
        ],
        [
            "- “横滑阈值 px ”（默认 60）：手指横向位移达到该值才会触发切换。调大更不易误触但更难触发；调小更灵敏但更容易误触。",
            '- "가로 스와이프 임계값 px"(기본값 60): 손가락 가로 이동 거리가 이 값에 도달해야 전환됩니다. 키우면 오작동이 줄지만 작동이 어렵고, 줄이면 민감해지지만 오작동하기 쉽습니다.',
        ],
        [
            "- “横滑阈值(px)”（默认 60）：手指横向位移达到该值才会触发切换。调大更不易误触但更难触发；调小更灵敏但更容易误触。",
            '- "가로 스와이프 임계값(px)"(기본값 60): 손가락 가로 이동 거리가 이 값에 도달해야 전환됩니다. 키우면 오작동이 줄지만 작동이 어렵고, 줄이면 민감해지지만 오작동하기 쉽습니다.',
        ],
        [
            "- WorldInfo 条目抽屉：点击后先“占位下移到位 + 动画 + 加载中”，动画结束再初始化重内容，避免展开过程掉帧。",
            '- WorldInfo 항목 드로어: 클릭 시 먼저 "자리 잡기 + 애니메이션 + 로딩"을 수행하고, 애니메이션 종료 후 무거운 콘텐츠를 초기화하여 프레임 드랍을 방지합니다.',
        ],
        [
            "- 当前包含：PromptManager 列表开关不再等待 token 计数完成（token 统计后台更新）。",
            "- 현재 포함 사항: PromptManager 목록 스위치는 더 이상 토큰 계산 완료를 기다리지 않습니다(토큰 통계는 백그라운드 갱신).",
        ],
        [
            "- 默认使用“指示线拖拽”：拖动时不让列表项跟随移动，只显示轻量拖拽影子+插入指示线；松手后一次性移动并保存顺序。",
            '- 기본적으로 "가이드라인 드래그" 사용: 드래그 시 항목이 따라다니지 않고 그림자와 삽입 위치 선만 표시됩니다. 놓으면 한 번에 이동하고 순서가 저장됩니다.',
        ],
        [
            "- 本模块用于优化“预设/配置相关面板”的交互体验。",
            '- 이 모듈은 "프리셋/설정 관련 패널"의 사용 경험을 최적화합니다.',
        ],
        [
            "- 本插件在“正则面板展开期间”拦截这些刷新；当面板收起/隐藏时才统一刷新一次。",
            '- 이 플러그인은 "정규식 패널이 열려있는 동안" 새로고침을 차단하고, 패널이 닫히거나 숨겨질 때 한 번에 새로고침합니다.',
        ],
        ["- 仅对", "- 다음 항목에만 적용: "],
        [
            "- 手势：当你已经到达顶部，再继续往上滚动/上拉一次，会触发“加载更多”（无需点击按钮）。",
            '- 제스처: 맨 위에 도달했을 때 한 번 더 위로 스크롤/당기면 "더 불러오기"가 트리거됩니다(버튼 클릭 불필요).',
        ],
        [
            "- 若遇到兼容性问题，可先关闭“跳过 JS-Slash-Runner”的选项测试。",
            '- 호환성 문제가 발생하면 먼저 "JS-Slash-Runner 건너뛰기" 옵션을 끄고 테스트하세요.',
        ],
        [
            "- 若遇到兼容性问题，可把“刷新策略”切到“全量重载聊天”。",
            '- 호환성 문제가 발생하면 "새로고침 전략"을 "채팅 전체 새로고침"으로 변경하세요.',
        ],
        [
            "- 如果遇到某些抽屉无法正常展开/关闭，可先关闭本模块对应开关回退。",
            "- 일부 드로어가 정상적으로 열리거나 닫히지 않으면, 이 모듈의 해당 스위치를 꺼서 복구하세요.",
        ],
        ["- 全局 slide*：把", "- 전역 Slide*: "],
        [
            "- 全局 slide*：把 slideToggle/slideDown/slideUp 的“高度动画”替换为合成层动画，减少各类面板展开时的掉帧。",
            '- 전역 Slide*: slideToggle/slideDown/slideUp의 "높이 애니메이션"을 컴포지션 레이어 애니메이션으로 대체하여 패널 전개 시 끊김을 줄입니다.',
        ],
        ["- 顶部抽屉：移除", "- 상단 드로어: 제거됨"],
        [
            "- 顶部抽屉：移除 height 过渡，改为 transform/opacity 动画，减少打开时的 layout 抖动。",
            "- 상단 드로어: 열 때 레이아웃 흔들림을 줄이기 위해 height 전환을 제거하고 transform/opacity 애니메이션으로 대체합니다.",
        ],
        [
            "- 条目编辑器缓存：同一世界书内会自动缓存已打开过的条目编辑器；切换世界书会自动清空缓存。",
            "- 항목 에디터 캐시: 같은 월드북 내에서 열었던 항목 에디터를 자동 캐시합니다. 월드북을 전환하면 캐시가 자동 초기화됩니다.",
        ],
        [
            "- 酒馆内置 Regex 在开关脚本时会触发",
            "- 태번 내장 Regex는 스크립트 전환 시 트리거됩니다.",
        ],
        [
            "- 酒馆内置 Regex 在开关脚本时会触发 reloadCurrentChat ，导致重复全量重渲染与正则重跑。",
            "- 태번 내장 Regex는 스크립트 전환 시 reloadCurrentChat을 트리거하여, 불필요한 전체 재렌더링과 정규식 재실행을 유발합니다.",
        ],
        [
            "- 酒馆核心使用 jQuery UI sortable 进行 WorldInfo 自定义排序。",
            "- 태번 코어는 WorldInfo 사용자 정의 정렬을 위해 jQuery UI sortable을 사용합니다.",
        ],
        ["${0}/${1} 条消息", "${0}/${1} 메시지"],
        [
            "，代码块仍可显示/复制。",
            ", 코드 블록은 여전히 표시/복사 가능합니다.",
        ],
        [
            "，导致重复全量重渲染与正则重跑。",
            ", 그 결과 전체 재렌더링과 정규식 재실행이 반복됩니다.",
        ],
        ["[酒馆助手]", "[태번 도우미]"],
        [
            "[酒馆助手]读取角色数据失败, 将使用空数据",
            "[태번 도우미] 캐릭터 데이터 로드 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "[酒馆助手]读取聊天数据失败, 将使用空数据",
            "[태번 도우미] 채팅 데이터 로드 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "[酒馆助手]读取预设数据失败, 将使用空数据",
            "[태번 도우미] 프리셋 데이터 로드 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "[酒馆助手]读取全局数据失败, 将使用空数据",
            "[태번 도우미] 글로벌 데이터 로드 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "[酒馆助手]连接实时监听功能出错, 尝试重连...",
            "[태번 도우미] 실시간 모니터링 연결 오류. 재연결 시도 중...",
        ],
        [
            "[酒馆助手]实时监听器断开连接",
            "[태번 도우미] 실시간 리스너 연결이 끊어졌습니다.",
        ],
        [
            "[酒馆助手]迁移旧数据失败, 将使用空数据",
            "[태번 도우미] 구 데이터 마이그레이션 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "\u003cdiv\u003e\u0027${0}\u0027 脚本包含脚本变量, 是否要清除? 如有 API Key 等敏感数据, 注意清除\u003c/div\u003e",
            "\u003cdiv\u003e\u0027${0}\u0027 스크립트에 변수가 포함되어 있습니다. 초기화하시겠습니까? API Key 등 민감한 정보가 있다면 삭제에 주의하세요.\u003c/div\u003e",
        ],
        [
            "\u003cdiv\u003e\u0027${0}\u0027 文件夹中 \u0027${1}\u0027 脚本包含脚本变量, 是否要清除? 如有 API Key 等敏感数据, 注意清除\u003c/div\u003e",
            "\u003cdiv\u003e\u0027${0}\u0027 폴더의 \u0027${1}\u0027 스크립트에 변수가 포함되어 있습니다. 초기화하시겠습니까? API Key 등 민감한 정보가 있다면 삭제에 주의하세요.\u003c/div\u003e",
        ],
        [
            "\u003cdiv\u003e\u003ch4\u003e此角色包含酒馆助手可用的嵌入式脚本\u003c/h4\u003e\u003ch4\u003e是否现在就启用它们?\u003c/h4\u003e\u003csmall\u003e您可以选择否, 稍后在“酒馆助手-脚本库-角色脚本”中手动启用它们\u003c/small\u003e\u003c/div\u003e",
            '\u003cdiv\u003e\u003ch4\u003e이 캐릭터에는 태번 도우미용 내장 스크립트가 포함되어 있습니다.\u003c/h4\u003e\u003ch4\u003e지금 활성화하시겠습니까?\u003c/h4\u003e\u003csmall\u003e아니요를 선택하면 나중에 "태번 도우미 - 스크립트 라이브러리 - 캐릭터 스크립트"에서 수동으로 활성화할 수 있습니다.\u003c/small\u003e\u003c/div\u003e',
        ],
        [
            "\u003cdiv\u003e\u003ch4\u003e此预设包含酒馆助手可用的嵌入式脚本\u003c/h4\u003e\u003ch4\u003e是否现在就启用它们?\u003c/h4\u003e\u003csmall\u003e您可以选择否, 稍后在“酒馆助手-脚本库-预设脚本”中手动启用它们\u003c/small\u003e\u003c/div\u003e",
            '\u003cdiv\u003e\u003ch4\u003e이 프리셋에는 태번 도우미용 내장 스크립트가 포함되어 있습니다.\u003c/h4\u003e\u003ch4\u003e지금 활성화하시겠습니까?\u003c/h4\u003e\u003csmall\u003e아니요를 선택하면 나중에 "태번 도우미 - 스크립트 라이브러리 - 프리셋 스크립트"에서 수동으로 활성화할 수 있습니다.\u003c/small\u003e\u003c/div\u003e',
        ],
        [
            "\u003cdiv\u003e更新日志加载中...\u003c/div\u003e",
            "\u003cdiv\u003e업데이트 로그 로드 중...\u003c/div\u003e",
        ],
        [
            "\u003cdiv\u003e确定要删除脚本吗? 此操作无法撤销\u003c/div\u003e",
            "\u003cdiv\u003e스크립트를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.\u003c/div\u003e",
        ],
        [
            "\u003cdiv\u003e确定要删除文件夹及其中所有脚本吗？此操作无法撤销\u003c/div\u003e",
            "\u003cdiv\u003e폴더와 그 안의 모든 스크립트를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.\u003c/div\u003e",
        ],
        [
            "\u003cdiv\u003e确定要删除音频吗? 此操作无法撤销\u003c/div\u003e",
            "\u003cdiv\u003e오디오를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.\u003c/div\u003e",
        ],
        ["API 错误", "API 오류"],
        ["cancelButton: 稍后", "취소 버튼: 나중에"],
        ["Debug 日志", "디버그 로그"],
        ["helper 追加到 body（避免裁剪）", "helper를 body에 추가(잘림 방지)"],
        [
            "hintBadge: true // 右下角角标（必须实现，默认开启）",
            "hintBadge: true // 우측 하단 배지 (필수 구현, 기본값 켜짐)",
        ],
        [
            "hintToast: true // “后台初始化中…” toast（必须实现，默认开启）",
            'hintToast: true // "백그라운드 초기화 중..." 토스트 (필수 구현, 기본값 켜짐)',
        ],
        [
            "HTML 未变时跳过 JS-Slash-Runner 的 MESSAGE_UPDATED",
            "HTML 변경 없을 시 JS-Slash-Runner의 MESSAGE_UPDATED 건너뛰기",
        ],
        ["HTML 渲染缓存", "HTML 렌더링 캐시"],
        ["lite（推荐）", "Lite (권장)"],
        ["okButton: 更新并刷新", "확인 버튼: 업데이트 및 새로고침"],
        [
            "Regex 编辑器依赖缺失，无法打开编辑器。",
            "Regex 에디터 의존성 파일이 없어 에디터를 열 수 없습니다.",
        ],
        ["title: HTML 渲染缓存", "제목: HTML 렌더링 캐시"],
        [
            "title: UI 动画与抽屉展开优化",
            "제목: UI 애니메이션 및 드로어 최적화",
        ],
        ["title: WorldInfo 拖拽排序优化", "제목: WorldInfo 드래그 정렬 최적화"],
        ["title: 启动加载优化", "제목: 시작 로딩 최적화"],
        ["title: 聊天渲染优化", "제목: 채팅 렌더링 최적화"],
        ["title: 保存中切换解锁", "제목: 저장 중 전환 잠금 해제"],
        ["title: 预设面板优化", "제목: 프리셋 패널 최적화"],
        ["title: 正则刷新优化", "제목: 정규식 새로고침 최적화"],
        ["token数过多提醒: 防止玩傻子AI", "토큰 과다 알림: 지능 저하 방지"],
        ["UI 动画与抽屉展开优化", "UI 애니메이션 및 드로어 최적화"],
        [
            "WorldInfo 子面板展开优化（替换 slideToggle）",
            "WorldInfo 하위 패널 전개 최적화 (slideToggle 대체)",
        ],
        [
            "WorldInfo 条目列表 content-visibility（实验）",
            "WorldInfo 항목 목록 content-visibility (실험적)",
        ],
        [
            "实验性：对离开视口的条目跳过布局/绘制，条目很多时滚动更顺；若出现显示异常请关闭。",
            "실험적 기능: 화면 밖으로 벗어난 항목의 레이아웃/그리기를 생략합니다. 항목이 많을 때 스크롤이 더 부드러워지며, 화면 표시 오류가 발생할 경우 이 기능을 꺼주세요.",
        ],
        ["加载更多每批", "배치당 추가 로드량"],
        [
            "可获得更一致的设置面板体验。",
            "더 일관된 설정 패널 경험을 제공합니다.",
        ],
        ["脚本", "스크립트"],
        [
            "脚本可能存在风险，请确保安全后再运行",
            "스크립트가 위험할 수 있습니다. 안전한지 확인 후 실행하세요.",
        ],
        ["脚本库", "스크립트 라이브러리"],
        ["脚本内容", "스크립트 내용"],
        ["脚本名称", "스크립트 이름"],
        [
            "脚本备注, 例如作者名、版本和注意事项等, 支持简单的 markdown 和 html",
            "작성자, 버전, 주의사항 등 스크립트 메모. 간단한 Markdown 및 HTML 지원",
        ],
        ["脚本的 JavaScript 代码", "스크립트 JavaScript 코드"],
        ["角色", "캐릭터"],
        ["角色脚本", "캐릭터 스크립트"],
        ["角色脚本库", "캐릭터 스크립트 라이브러리"],
        [
            "角色卡绑定预设: 切换到某个角色卡时自动切换为对应预设",
            "캐릭터 카드별 프리셋 바인딩: 캐릭터 변경 시 해당 프리셋으로 자동 전환",
        ],
        ["开启 content-visibility（实验）", "content-visibility 켜기 (실험적)"],
        ["开启前端渲染", "프론트엔드 렌더링 켜기"],
        ["开发工具", "개발자 도구"],
        ["警告", "경고"],
        ["更多操作", "추가 작업"],
        ["更新", "업데이트"],
        ["更新失败: ${0}", "업데이트 실패: ${0}"],
        ["更新酒馆助手失败", "태번 도우미 업데이트 실패"],
        ["启动加载优化（前端扩展）", "시작 로딩 최적화 (프론트엔드 확장)"],
        ["启动优化", "시작 최적화"],
        ["鸡尾酒", "칵테일"],
        ["启用", "활성화"],
        ["启用 Blob URL 渲染", "Blob URL 렌더링 활성화"],
        [
            "启用 HTML 渲染缓存（编辑不刷新）",
            "HTML 렌더링 캐시 활성화 (편집 시 새로고침 안 함)",
        ],
        ["启用 UI 动画与展开优化", "UI 애니메이션 및 전개 최적화 활성화"],
        [
            "启用 WorldInfo 拖拽排序优化（自定义排序）",
            "WorldInfo 드래그 정렬 최적화 활성화 (사용자 정의 정렬)",
        ],
        ["启用：保存中仍可切换对话", "활성화: 저장 중에도 대화 전환 허용"],
        ["启用加载动画", "로딩 애니메이션 활성화"],
        ["启用代码折叠", "코드 접기 활성화"],
        ["启用渲染器", "렌더러 활성화"],
        [
            "启用预设面板优化（先切换 UI，后台补齐统计）",
            "프리셋 패널 최적화 활성화 (UI 우선 전환, 백그라운드 통계 갱신)",
        ],
        [
            "启用优化（面板收起后再刷新）",
            "최적화 활성화 (패널 닫은 후 새로고침)",
        ],
        ["启用弹窗报错", "팝업 에러 보고 활성화"],
        [
            "启用后，符合条件的代码块将被渲染",
            "활성화 시 조건에 맞는 코드 블록이 렌더링됩니다.",
        ],
        ["滚动触发距离(px)", "스크롤 트리거 거리 (px)"],
        ["工具箱", "도구 상자"],
        ["过渡，改为", "전환(Transition)을 다음으로 변경: "],
        ["过滤", "필터"],
        ["官方编写模板配置教程", "공식 템플릿 작성 튜토리얼"],
        ["禁用", "비활성화"],
        ["禁用代码块高亮（推荐）", "코드 블록 하이라이팅 비활성화 (권장)"],
        ["禁用酒馆助手宏", "태번 도우미 매크로 비활성화"],
        [
            "禁用抽屉背景模糊（backdrop-filter）",
            "드로어 배경 흐림 비활성화 (backdrop-filter)",
        ],
        [
            "内容，改为显示占位符（点击占位符可展开原代码块），并同时隐藏复制按钮。",
            "내용 대신 자리 표시자를 표시하고(클릭 시 원본 전개), 복사 버튼을 숨깁니다.",
        ],
        ["内置库", "내장 라이브러리"],
        [
            "内置库更多是作为脚本能做什么的示例, 更多实用脚本请访问社区的工具区",
            "내장 라이브러리는 예시 성격이 강합니다. 더 실용적인 스크립트는 커뮤니티 도구 구역을 확인하세요.",
        ],
        ["单个添加", "개별 추가"],
        [
            "当前 API 不是聊天补全, 无法使用提示词查看器功能",
            "현재 API는 채팅 완성이 아니므로 프롬프트 뷰어 기능을 사용할 수 없습니다.",
        ],
        ["当前版本: ${0}", "현재 버전: ${0}"],
        ["导入", "가져오기"],
        [
            "导入脚本文件 \u0027${0}\u0027 失败",
            "스크립트 파일 \u0027${0}\u0027 가져오기 실패",
        ],
        ["导入音频链接", "오디오 링크 가져오기"],
        ["导出脚本", "스크립트 내보내기"],
        [
            "动画，减少打开时的 layout 抖动。",
            "애니메이션, 열 때 레이아웃 떨림 감소.",
        ],
        [
            "等待已有生成请求完成... (或用刷新按钮强制取消它)",
            "기존 생성 요청 완료 대기 중... (또는 새로고침으로 강제 취소)",
        ],
        ["链接", "링크"],
        [
            "连接编写模板，将代码修改实时同步到酒馆",
            "작성 템플릿 연결: 코드 수정 사항을 태번에 실시간 동기화",
        ],
        ["列表编辑", "목록 편집"],
        [
            "例如我个人除了内置库外还有",
            "예를 들어, 저는 내장 라이브러리 외에도 다음을 사용합니다: ",
        ],
        ["路径已复制", "경로 복사됨"],
        ["聊天", "채팅"],
        [
            "留空将自动从链接中提取文件名",
            "비워두면 링크에서 파일명을 자동 추출합니다.",
        ],
        ["立即刷新一次", "지금 새로고침"],
        ["立即刷新一次（不关闭面板）", "즉시 1회 새로고침 (패널 닫지 않음)"],
        ["网址已复制", "URL 복사됨"],
        ["每帧条数", "프레임당 항목 수"],
        [
            "每行一个链接，可选格式：URL 或 URL,标题",
            "한 줄에 링크 하나. 형식: URL 또는 URL,제목",
        ],
        ["模型", "모델"],
        [
            "无法加载 Regex 编辑器依赖，无法打开编辑器。",
            "Regex 에디터 의존성을 로드할 수 없어 에디터를 열 수 없습니다.",
        ],
        ["无法复制路径，请手动复制", "경로 복사 실패. 수동으로 복사하세요."],
        [
            "无法找到版本 \u0027${0}\u0027 的日志",
            "버전 \u0027${0}\u0027의 로그를 찾을 수 없습니다.",
        ],
        ["文件夹", "폴더"],
        ["文件夹图标:", "폴더 아이콘:"],
        ["文件夹名称:", "폴더 이름:"],
        [
            "文本）实现；不解析复杂 DOM。",
            "텍스트)로 구현; 복잡한 DOM은 파싱하지 않습니다.",
        ],
        [
            "未连接到 API, 提示词查看器将无法获取数据",
            "API 연결되지 않은 상태. 프롬프트 뷰어가 데이터를 가져올 수 없습니다.",
        ],
        ["未命名变量", "이름 없는 변수"],
        ["未填写作者备注", "작성자 메모 없음"],
        ["防误触左右滑动切换", "좌우 스와이프 오작동 방지"],
        [
            "绑定到脚本的变量, 会随脚本一同导出",
            "스크립트에 바인딩된 변수는 스크립트와 함께 내보내집니다.",
        ],
        ["绑定到当前角色卡", "현재 캐릭터 카드에 바인딩"],
        ["绑定到当前预设", "현재 프리셋에 바인딩"],
        ["方向锁倍率 dx/dy", "방향 잠금 배율 dx/dy"],
        ["方向锁倍率(dx/dy)", "방향 잠금 배율(dx/dy)"],
        ["变量管理器", "변수 관리자"],
        ["变量列表", "변수 목록"],
        ["边缘自动滚动", "가장자리 자동 스크롤"],
        [
            "保存预设条目时直接保存预设",
            "프리셋 항목 저장 시 프리셋도 즉시 저장",
        ],
        ["保存中", "저장 중"],
        [
            "复用预取结果（fetch 去重）",
            "미리 가져온 결과 재사용 (Fetch 중복 방지)",
        ],
        ["复制脚本", "스크립트 복제"],
        ["复制网址", "URL 복사"],
        [
            "本扩展免费使用，禁止任何形式的商业用途",
            "이 확장 프로그램은 무료이며, 모든 형태의 상업적 이용을 금지합니다.",
        ],
        [
            "仅当保存请求（/api/chats/save 或 /api/chats/group/save）已经发出且仍在进行时，允许你切换角色/群组；并在右下角显示“↓ / 保存中”提示。保存失败时可点击该提示重试。",
            '저장 요청(/api/chats/save 또는 /api/chats/group/save)이 진행 중일 때만 캐릭터/그룹 전환을 허용합니다. 우측 하단에 "↓ / 저장 중"이 표시됩니다. 저장 실패 시 해당 메시지를 눌러 재시도할 수 있습니다.',
        ],
        ["仅前端", "프론트엔드 전용"],
        ["仅显示匹配", "일치하는 항목만 표시"],
        ["批量导入", "일괄 가져오기"],
        ["批量操作", "일괄 작업"],
        [
            "查看脚本和渲染界面的控制台日志",
            "스크립트 및 렌더링 인터페이스의 콘솔 로그 보기",
        ],
        ["查看教程及文档", "튜토리얼 및 문서 보기"],
        [
            "查看当前提示词发送情况，窗口开启时会监听新的发送及时更新显示",
            "현재 전송된 프롬프트를 확인합니다. 창이 열려있으면 새로운 전송을 감지해 업데이트합니다.",
        ],
        ["查看手册", "매뉴얼 보기"],
        ["查看作者备注", "작성자 메모 보기"],
        [
            "查看和管理全局、角色、聊天、消息楼层变量",
            "글로벌, 캐릭터, 채팅, 메시지 변수 확인 및 관리",
        ],
        [
            "使用 Blob URL 渲染前端界面，更方便 f12 开发者工具调试",
            "Blob URL로 프론트엔드를 렌더링하여 F12 디버깅을 돕습니다. 렌더링 문제가 생기면 이 옵션을 끄세요.",
        ],
        [
            "使用 Blob URL 渲染前端界面，更方便 f12 开发者工具调试",
            "Blob URL로 프론트엔드를 렌더링하여 F12 디버깅을 돕습니다.",
        ],
        ["使用方法", "사용법"],
        ["删除脚本", "스크립트 삭제"],
        [
            "删除角色卡时删除绑定的主要世界书",
            "캐릭터 카드 삭제 시 연결된 기본 월드북도 삭제",
        ],
        ["详细", "상세"],
        ["生效。", "적용됨."],
        ["渲染器", "렌더러"],
        ["渲染深度", "렌더링 깊이"],
        ["选择图标", "아이콘 선택"],
        ["选择颜色", "색상 선택"],
        ["选择创建目标", "생성 대상 선택"],
        ["说明：", "설명: "],
        [
            "说明：扩展无法消除入口处等待 window.load 的时间，但可以让你更早看到主界面，并减少后半段接口等待。",
            "설명: 확장 프로그램이 window.load 대기 시간을 없앨 순 없지만, 메인 화면을 더 빨리 띄우고 이후 인터페이스 로딩 대기를 줄여줍니다.",
        ],
        [
            "设置需要渲染的楼层数，从最新楼层开始计数。为 0 时，将渲染所有楼层",
            "렌더링할 메시지 수 설정(최신 메시지부터). 0이면 모든 메시지를 렌더링합니다.",
        ],
        [
            "成功导入脚本 \u0027${0}\u0027",
            "스크립트 \u0027${0}\u0027 가져오기 성공",
        ],
        [
            "成功导入脚本: \u0027${0}\u0027",
            "스크립트 가져오기 성공: \u0027${0}\u0027",
        ],
        [
            "成功导入脚本文件夹 \u0027${0}\u0027",
            "스크립트 폴더 \u0027${0}\u0027 가져오기 성공",
        ],
        ["成功编辑键名", "키 이름 수정 성공"],
        ["成功编辑值", "값 수정 성공"],
        ["世界书强制用推荐的全局设置", "월드북: 권장 글로벌 설정 강제 적용"],
        ["世界书强制自定义排序", "월드북: 사용자 정의 정렬 강제 적용"],
        [
            "世界书繁简互换: 一键将繁体/简体世界书翻译成简体/繁体",
            "월드북 번체/간체 변환: 번체/간체 월드북을 한 번에 번역",
        ],
        ["消息", "메시지"],
        ["消息楼层", "메시지 번호"],
        ["所有日志", "모든 로그"],
        ["关闭", "닫기"],
        ["关闭前端渲染", "프론트엔드 렌더링 끄기"],
        ["刷新间隔 (毫秒)", "새로고침 간격 (ms)"],
        ["刷新策略", "새로고침 전략"],
        ["手机或 AI 官网用", "모바일 또는 AI 공식 사이트용"],
        ["收起内容", "내용 접기"],
        ["收起图片", "이미지 접기"],
        ["收起后延迟 ms", "접은 후 지연 (ms)"],
        ["收起后延迟(ms)", "접은 후 지연 (ms)"],
        [
            "需配合代码里的 getButtonEvent 使用",
            "코드 내 getButtonEvent와 함께 사용해야 함",
        ],
        ["首屏渲染条数", "첫 화면 렌더링 개수"],
        ["搜索（支持普通和/正则/）", "검색 (일반 및 /정규식/ 지원)"],
        ["搜索消息内容...", "메시지 내용 검색..."],
        ["搜索日志内容...", "로그 내용 검색..."],
        ["随机播放", "랜덤 재생"],
        ["输入助手", "입력 도우미"],
        [
            "示例：\nhttps://example.com/audio1.mp3\nhttps://example.com/audio2.mp3,我的音乐\nhttps://example.com/audio3.mp3",
            "예시:\nhttps://example.com/audio1.mp3\nhttps://example.com/audio2.mp3,내 음악\nhttps://example.com/audio3.mp3",
        ],
        [
            "是否尝试通过卸载重装来更新? (以防由于网络问题重装没能成功, 请先复制网址)",
            "삭제 후 재설치하여 업데이트하시겠습니까? (네트워크 문제로 실패할 경우를 대비해 URL을 먼저 복사하세요)",
        ],
        ["信息", "정보"],
        ["实时监听", "실시간 모니터링"],
        [
            "深度条目排斥器: 让深度条目只能在 D0 或 D9999",
            "깊이(Depth) 제한기: 깊이 항목을 D0 또는 D9999에만 배치",
        ],
        ["按钮", "버튼"],
        ["按钮名称", "버튼 이름"],
        [
            "压缩相邻消息: 让 AI 对内容理解更连贯",
            "인접 메시지 압축: AI가 내용을 더 일관되게 이해하도록 돕습니다.",
        ],
        [
            "如果需要制作脚本, 建议查看",
            "스크립트를 제작하려면 다음을 참조하세요: ",
        ],
        ["预设", "프리셋"],
        ["预设脚本", "프리셋 스크립트"],
        ["预设脚本库", "프리셋 스크립트 라이브러리"],
        ["预设防误触", "오작동 방지 프리셋"],
        [
            "预设条目更多按钮: 一键新增预设条目",
            "프리셋 항목 더보기 버튼: 원클릭으로 프리셋 항목 추가",
        ],
        [
            "预取关键接口（avatars / characters / backgrounds）",
            "핵심 인터페이스 미리 불러오기 (avatars/characters/backgrounds)",
        ],
        [
            "预取关键接口（avatars/characters/backgrounds）",
            "핵심 인터페이스 미리 불러오기 (avatars/characters/backgrounds)",
        ],
        ["预取条目:", "항목 미리 불러오기:"],
        ["预取超时 ms", "미리 불러오기 타임아웃 (ms)"],
        ["预取超时(ms)", "미리 불러오기 타임아웃 (ms)"],
        ["缓存过期(ms)", "캐시 만료 (ms)"],
        ["原生 sortable（跟随移动）", "기본 Sortable (이동 따라감)"],
        ["允许监听", "모니터링 허용"],
        ["允许流式渲染", "스트리밍 렌더링 허용"],
        ["隐藏代码块（占位符）", "코드 블록 숨기기 (자리 표시자)"],
        ["音频链接", "오디오 링크"],
        ["音频链接 URL", "오디오 링크 URL"],
        ["音频标题（可选）", "오디오 제목 (선택)"],
        ["音乐", "음악"],
        ["音效", "효과음"],
        ["应用并重载聊天", "적용 및 채팅 새로고침"],
        ["移动脚本", "스크립트 이동"],
        ["已复制!", "복사 완료!"],
        [
            "已复制全部提示词到剪贴板",
            "모든 프롬프트를 클립보드에 복사했습니다.",
        ],
        ["模型上下文处理", "모델 컨텍스트 처리"],
        [("已复制提示词到剪贴板", "프롬프트를 클립보드에 복사했습니다.")],
        ["一键禁用条目递归", "원클릭으로 항목 재귀 비활성화"],
        ["日志查看器", "로그 뷰어"],
        [
            "作者：KAKAA，青空莉想做舞台少女的狗",
            "작성자: KAKAA, 아오조라 리는 무대소녀의 개가 되고 싶어",
        ],
        ["作者备注", "작성자 메모"],
        ["暂无脚本", "스크립트 없음"],
        ["暂无变量值", "변수 값 없음"],
        ["暂无音频", "오디오 없음"],
        [
            "在AI流式输出时就渲染，某些前端界面可能无法这样渲染。此外，这可能与某些脚本、插件、酒馆美化不兼容",
            "AI 스트리밍 출력 중에 렌더링합니다. 일부 인터페이스는 이를 지원하지 않을 수 있으며, 특정 스크립트, 플러그인, 태번 테마와 충돌할 수 있습니다.",
        ],
        [
            "在前端内字体、图片等资源未加载完成前，显示加载动画而不是显示不完全界面",
            "폰트, 이미지 등 리소스 로딩이 끝나기 전, 깨진 화면 대신 로딩 애니메이션을 보여줍니다.",
        ],
        ["这些脚本", "이 스크립트들"],
        [
            "的“高度动画”替换为合成层动画，减少各类面板展开时的掉帧。",
            '의 "높이 애니메이션"을 컴포지션 레이어 애니메이션으로 교체해 프레임 드랍을 줄입니다.',
        ],
        [
            "的楼层生效（JS-Slash-Runner 渲染结果）。",
            "번 메시지에 적용 (JS-Slash-Runner 렌더링 결과).",
        ],
        ["展开", "펼치기"],
        ["全局", "글로벌"],
        ["全局脚本", "글로벌 스크립트"],
        ["全局脚本库", "글로벌 스크립트 라이브러리"],
        ["全局音频播放器", "글로벌 오디오 플레이어"],
        [
            "全局替换 slideToggle/slideUp/slideDown（减少 height 动画卡顿）",
            "전역 slideToggle/slideUp/slideDown 교체 (height 애니메이션 끊김 감소)",
        ],
        [
            "全局替换 jQuery 的 slideToggle/slideDown/slideUp（height 动画）为 transform/opacity，覆盖：大多数 inline-drawer、PromptManager（预设配置面板）等。",
            "jQuery의 slideToggle/slideDown/slideUp(높이 애니메이션)을 transform/opacity 방식으로 전역 교체합니다. 대부분의 인라인 드로어(펼치기 목록)와 프롬프트 매니저(프리셋 설정 패널) 등에 적용됩니다.",
        ],
        ["电脑编写模板用", "PC 작성 템플릿용"],
        ["全量重载聊天（更稳）", "채팅 전체 새로고침 (안정적)"],
        ["全部", "전체"],
        [
            "折叠指定类型的代码块，当选择“仅前端”时，将只折叠可渲染成前端界面但没被渲染的代码块",
            '지정된 유형의 코드 블록을 접습니다. "프론트엔드 전용" 선택 시, 프론트엔드로 렌더링 가능하지만 렌더링되지 않은 블록만 접습니다.',
        ],
        [
            "顶部面板展开优化（transform/opacity）",
            "상단 패널 전개 최적화 (transform/opacity)",
        ],
        ["正序显示", "오름차순 표시"],
        ["正在加载脚本...", "스크립트 로딩 중..."],
        ["正在加载作者备注...", "작성자 메모 로딩 중..."],
        ["正在更新酒馆助手...", "태번 도우미 업데이트 중..."],
        [
            "正在发送虚假生成请求, 从而获取最新提示词...",
            "최신 프롬프트를 얻기 위해 더미 생성 요청을 보내는 중...",
        ],
        ["正在卸载重装酒馆助手...", "태번 도우미 삭제 및 재설치 중..."],
        [
            "正在获取生成请求中的提示词...",
            "생성 요청에서 프롬프트 가져오는 중...",
        ],
        ["正则刷新优化", "정규식 새로고침 최적화"],
        ["第 ${0} 楼", "${0}번째 메시지"],
        ["第${0}楼-第${1}个界面", "${0}번째 메시지 - ${1}번째 인터페이스"],
        [
            "提示：toast（后台初始化中…）",
            "안내: 토스트 (백그라운드 초기화 중...)",
        ],
        ["提示：安装", "안내: 설치"],
        [
            "提示：安装 st-api-wrapper 可获得更一致的设置面板体验。",
            "안내: st-api-wrapper를 설치하면 더 일관된 설정 패널 경험을 얻을 수 있습니다.",
        ],
        ["提示：右下角角标", "안내: 우측 하단 배지"],
        ["提示词查看器", "프롬프트 뷰어"],
        ["提示延迟", "프롬프트 지연"],
        ["提前无感预加载", "이전 메시지 자동 로드"],
        ["提前触发 px", "사전 트리거 px"],
        ["提前触发(px)", "사전 트리거 (px)"],
        [
            "提前解除遮罩（SETTINGS_LOADED 后 hideLoader）",
            "마스크 조기 해제 (SETTINGS_LOADED 후 hideLoader)",
        ],
        [
            "提前解除遮罩（SETTINGS_LOADED 后）",
            "마스크 조기 해제 (SETTINGS_LOADED 후)",
        ],
        ["提前解除遮罩:", "마스크 조기 해제:"],
        ["调试日志", "디버그 로그"],
        ["调试日志（console.debug）", "디버그 로그 (console.debug)"],
        ["酒馆STScript与宏", "태번 STScript 및 매크로"],
        ["酒馆全局可用", "태번 글로벌 사용 가능"],
        ["酒馆助手", "태번 도우미"],
        ["酒馆助手脚本-${0}.json", "태번_도우미_스크립트-${0}.json"],
        [
            "酒馆助手更新成功, 准备刷新页面以生效...",
            "태번 도우미 업데이트 성공. 적용을 위해 페이지를 새로고침합니다...",
        ],
        [
            "酒馆助手已是最新版本, 无需更新",
            "태번 도우미가 이미 최신 버전입니다.",
        ],
        ["主设置", "메인 설정"],
        ["重复播放当前曲目", "현재 곡 반복"],
        ["重复播放所有曲目", "전체 반복"],
        ["增量重渲染（推荐）", "증분 재렌더링 (권장)"],
        ["指示线拖拽（推荐，更流畅）", "가이드라인 드래그 (권장, 더 부드러움)"],
        ["且已存在", "및 이미 존재함"],
        ["错误", "오류"],
        ["创建新脚本", "새 스크립트 만들기"],
        ["创建新文件夹", "새 폴더 만들기"],
        ["添加更多", "더 추가하기"],
        ["请输入文件夹名称", "폴더 이름을 입력하세요"],
        ["清除数据导出", "데이터 내보내기 삭제"],
        ["清除日志", "로그 지우기"],
        ["总token数", "총 토큰 수"],
        ["最大速度(px/f)", "최대 속도 (px/f)"],
        [
            "最大化预设上下文长度: 避免酒馆错误地截断本来可以完整发给 AI 的提示词",
            "프리셋 컨텍스트 길이 최대화: 태번이 AI에 보낼 수 있는 프롬프트를 실수로 자르는 것을 방지합니다.",
        ],
        [
            '最大化预设上下文长度: 避免酒馆错误地截断本来可以完整发给 AI 的提示词"',
            "프리셋 컨텍스트 길이 최대화: 태번이 AI에 보낼 수 있는 프롬프트를 실수로 자르는 것을 방지합니다.",
        ],
        [
            "“最大化预设上下文长度: 避免酒馆错误地截断本来可以完整发给 AI 的提示词”",
            "프리셋 컨텍스트 길이 최대화: 태번이 AI에 보낼 수 있는 프롬프트를 실수로 자르는 것을 방지합니다.",
        ],
        ["最小速度(px/f)", "최소 속도 (px/f)"],
        ["最新: Ver ${0}", "최신: Ver ${0}"],
        ["最新楼层号", "최신 메시지 번호"],
        ["追踪最新", "최신 추적"],
        ["取消", "취소"],
        ["取消代码块高亮", "코드 블록 하이라이팅 해제"],
        ["打开", "열기"],
        ["拖拽 helper", "드래그 도우미"],
        ["拖拽引擎", "드래그 엔진"],
        ["播放器", "플레이어"],
        ["播放当前曲目并停止", "현재 곡 재생 후 정지"],
        ["播放列表", "재생 목록"],
        ["版本更新", "버전 업데이트"],
        ["编写脚本的参考文档", "스크립트 작성 참고 문서"],
        [
            "编写变量角色卡而非测试/游玩角色卡时，打开此开关，避免 {{get_message_variable::变量}} 等宏被替换",
            "테스트/플레이용이 아닌 변수용 캐릭터 카드를 작성할 때 이 스위치를 켜세요. {{get_message_variable::변수}} 등의 매크로 대체를 방지합니다.",
        ],
        ["编写参考", "작성 참고"],
        ["编辑脚本", "스크립트 편집"],
        ["编辑文件夹", "폴더 편집"],
        ["编辑音频项", "오디오 항목 편집"],
        ["包含数据导出", "데이터 내보내기 포함"],
        ["标题", "제목"],
        ["标题（可选）", "제목 (선택)"],
        [
            "标签化: 随世界书、预设或链接配置自动开关正则、提示词条目",
            "태그화: 월드북, 프리셋, 링크 설정에 따라 정규식/프롬프트 항목을 자동 제어",
        ],
        ["下载STScript参考文件", "STScript 참고 파일 다운로드"],
        ["下载宏参考文件", "매크로 참고 파일 다운로드"],
        ["下载参考文件", "참고 파일 다운로드"],
        ["确认", "확인"],
        [
            "该脚本未勾选任何 Affects：可能不会生效，但仍会保存。",
            "이 스크립트는 Affects가 선택되지 않았습니다. 작동하지 않을 수 있지만 저장은 됩니다.",
        ],
        ["行隐藏内容", "행 숨김 내용"],
        ["显示图片", "이미지 표시"],
        ["扩展加载后(ms):", "확장 로드 후(ms):"],
        [
            "扩展面板 inline-drawer 展开优化（替换 slideToggle）",
            "확장 패널 inline-drawer 전개 최적화 (slideToggle 대체)",
        ],
        [
            "对扩展设置面板（#extensions_settings2 / #extensions_settings）内的 inline-drawer 生效，替换 slideToggle，减少展开卡顿。",
            "확장 설정 패널(#extensions_settings2 / #extensions_settings) 내의 펼치기 목록(inline-drawer)에 적용됩니다. slideToggle을 대체하여 패널을 열 때 발생하는 끊김 현상을 줄여줍니다.",
        ],
        [
            "仅对 WorldInfo（#WorldInfo）范围内的 inline-drawer 生效，避免影响其它面板。",
            "월드북(#WorldInfo) 범위 내의 펼치기 목록에만 적용하여 다른 패널에 영향을 주지 않도록 합니다.",
        ],
        ["扩展信息", "확장 정보"],
        ["获取更新日志失败", "업데이트 로그 가져오기 실패"],
        ["横滑阈值 px", "가로 스와이프 임계값 px"],
        ["横滑阈值(px)", "가로 스와이프 임계값 (px)"],
        [
            "后台仍在初始化中，部分功能会稍后就绪。",
            "백그라운드 초기화 중입니다. 일부 기능은 잠시 후 준비됩니다.",
        ],
        ["后台合并延迟(ms)", "백그라운드 병합 지연 (ms)"],
        [
            "标签化: 根据预设自动开关正则、根据模型自动切换破限",
            "태그화: 프리셋별 정규식 자동 온오프 및 모델별 탈옥 자동 전환",
        ],
        ["作者:", "제작자:"],
        ["版本:", "버전:"],
        ["原帖:", "원본 게시물:"],
        ["源文件:", "소스 파일:"],
        ["说明:", "설명:"],
        ["使用说明", "사용 지침"],
        ["点此跳转", "여기를 눌러 이동"],
        ["演示视频", "데모 영상"],
        ["标签化正则演示", "태그화 정규식 데모"],
        ["标签化预设提示词演示", "태그화 프리셋 프롬프트 데모"],
    ]);

    // Preferred natural Korean overrides for key UI surfaces.
    const OVERRIDE_MAP = new Map([
        // cocktail main
        ["鸡尾酒", "칵테일"],
        [
            "综合优化：启动加载 / 聊天渲染 / 正则刷新 等（按需启用）",
            "통합 최적화: 시작 로딩 / 채팅 렌더링 / 정규식 새로고침 등 (필요시 활성화)",
        ],

        // cocktail subpanel headers
        ["启动加载优化", "시작 로딩 최적화"],
        ["聊天渲染优化", "채팅 렌더링 최적화"],
        ["正则刷新优化", "정규식 새로고침 최적화"],
        ["预设面板优化", "프리셋 패널 최적화"],
        ["保存中切换解锁", "저장 중 전환 잠금 해제"],
        ["UI 动画与抽屉展开优化", "UI 애니메이션 및 드로어 전개 최적화"],
        ["WorldInfo 拖拽排序优化", "WorldInfo 드래그 정렬 최적화"],
        [
            "说明：扩展无法消除入口处等待 window.load 的时间，但可以让你更早看到主界面，并减少后半段接口等待。",
            "설명: 이 확장은 window.load 대기 시간을 없앨 순 없지만, 메인 화면을 더 빨리 보여주고 이후 API 대기 시간을 단축시킵니다.",
        ],
        ["说明：扩展无法消除入口处等待", "설명: 확장이 초기 진입 시"],
        [
            "的时间，但可以让你更早看到主界面，并减少后半段接口等待。",
            "대기 시간을 없앨 순 없지만, 메인 화면을 더 빨리 띄우고 API 대기 시간을 줄여줍니다.",
        ],

        // cocktail popups / dialogs
        ["【鸡尾酒】发现新版本", "[칵테일] 새 버전 발견"],
        ["是否现在更新？", "지금 업데이트하시겠습니까?"],
        ["更新并刷新", "업데이트 및 새로고침"],
        ["稍后", "나중에"],
        ["扩展更新失败", "확장 프로그램 업데이트 실패"],
        [
            "更新完成，页面即将刷新…",
            "업데이트 완료. 곧 페이지가 새로고침됩니다...",
        ],
        [
            "确定要移动这个正则脚本吗？",
            "이 정규식 스크립트를 이동하시겠습니까?",
        ],
        [
            "确定要删除这个正则脚本吗？",
            "이 정규식 스크립트를 삭제하시겠습니까?",
        ],
        ["Regex 脚本拖拽排序优化", "Regex 스크립트 드래그 순서 변경 최적화"],
        [
            "启用 Regex 脚本拖拽排序优化（指示线拖拽）",
            "Regex 스크립트 드래그 순서 변경 최적화 활성화 (안내선 방식)",
        ],
        [
            "推荐：指示线拖拽（拖动中不重排条目，松手一次性移动并保存），对重 UI 条目更流畅。",
            "권장: 안내선 드래그 (드래그 중에는 항목을 재정렬하지 않고, 마우스를 놓을 때 한 번에 이동 및 저장). 항목 UI가 복잡할 때 훨씬 부드럽게 작동합니다.",
        ],
        [
            "仅对“原生 sortable（跟随移动）”引擎生效：lite=轻量拖拽块；clone=克隆原条目（更接近原始外观，但更重）。",
            "'기본 Sortable (실시간 이동)' 엔진에서만 적용: lite = 경량 드래그 블록, clone = 원본 항목 복제 (원래 모습과 가깝지만 리소스를 더 많이 사용함).",
        ],
        [
            "拖拽接近列表上下边缘时自动滚动，便于把脚本拖到很远的位置。",
            "목록의 상하 가장자리 근처로 드래그하면 자동으로 스크롤되어, 스크립트를 먼 곳으로 쉽게 옮길 수 있습니다.",
        ],
        [
            "指针距离列表上下边缘小于该值时开始自动滚动。",
            "마우스 포인터와 목록 가장자리 사이의 거리가 이 값보다 작아지면 자동 스크롤이 시작됩니다.",
        ],
        [
            "拖拽靠近边缘时的最小滚动速度（每帧像素）。",
            "가장자리 근처에서 드래그할 때의 최소 스크롤 속도 (프레임당 픽셀).",
        ],
        [
            "拖拽贴近/越过边缘时的最大滚动速度（每帧像素）。",
            "가장자리에 완전히 붙거나 벗어났을 때의 최대 스크롤 속도 (프레임당 픽셀).",
        ],
        ["说明:", "설명:"],
        [
            "- 核心 regex 扩展使用 jQuery UI sortable 对脚本列表排序，stop 时会保存顺序并刷新聊天。",
            "- 핵심 Regex 확장 기능은 jQuery UI Sortable을 사용하여 스크립트 목록을 정렬하며, 드래그가 끝날 때(Stop) 순서를 저장하고 채팅창을 새로고침합니다.",
        ],
        [
            "- 本模块默认把拖拽过程改为“指示线拖拽”：拖动中不触发列表重排，只在松手时一次性移动并复用 core stop 回调保存。",
            "- 이 모듈은 드래그 방식을 '안내선 드래그'로 변경합니다: 드래그 도중에는 목록이 실시간으로 재구성되지 않으며, 마우스를 놓는 순간 한 번에 이동한 뒤 기존의 정지(Stop) 콜백을 호출하여 저장합니다.",
        ],
        [
            "- 如遇兼容性问题，可切换到“原生 sortable”。",
            "- 호환성 문제가 발생할 경우 '기본 Sortable' 방식으로 전환하세요.",
        ],

        // JS-Slash-Runner branding / quick buttons
        ["酒馆助手", "태번 도우미"],
        ["+ 脚本", "+ 스크립트"],
        ["+ 文件夹", "+ 폴더"],
        ["脚本", "스크립트"],
        ["文件夹", "폴더"],

        ["渲染", "렌더링"],
        ["渲染优化", "렌더링 최적화"],
        ["工具", "도구"],
        ["优化", "최적화"],
        ["开发", "개발"],
        ["世界书", "월드북"],
        ["最大化预设上下文长度", "프리셋 컨텍스트 길이 최대화"],
        ["性能", "성능"],
        ["角色卡", "캐릭터 카드"],
        ["菜单", "메뉴"],
        ["查看日志", "로그 보기"],
        ["发现新版本: ${latest_version}", "새 버전 발견: ${latest_version}"],
        [
            "最新: ${await getLatestVersion()}",
            "최신: ${await getLatestVersion()}",
        ],
        [
            "更新失败: ${(await update_response.text()) || update_response.statusText}",
            "업데이트 실패: ${(await update_response.text()) || update_response.statusText}",
        ],
        ["类脑", "ΟΔΥΣΣΕΙΑ"],
        ["旅程", "ΟΡΙΖΟΝΤΑΣ"],
        [("模型上下文处理", "모델 컨텍스트 처리")],
        ["联动和绑定", "연동 및 바인딩"],
        ["体验优化", "사용자 경험 최적화"],
        ["实验功能", "실험적 기능"],
        ["杂项", "기타"],
        ["禁用不兼容选项", "호환되지 않는 옵션 비활성화"],
        ["切换预设时提醒还没有保存", "프리셋 변경 시 미저장 상태 알림"],
        ["强制使用推荐的世界书全局设置", "권장 월드북 전역 설정 강제 적용"],
        [
            "导出角色卡时始终携带最新世界书",
            "캐릭터 카드 내보내기 시 최신 월드북 항상 포함",
        ],
        [
            "使用[替换/更新角色卡]功能时更新世界书",
            "[캐릭터 카드 교체/업데이트] 기능 사용 시 월드북 업데이트",
        ],
        ["取消前端代码高亮", "프론트엔드 코드 하이라이팅 비활성화"],
        [
            "避免酒馆对可渲染成前端界面的代码块进行语法高亮，从而提升渲染性能",
            "태번이 프론트엔드 UI로 렌더링 가능한 코드 블록에 문법 강조를 적용하지 않도록 하여, 렌더링 성능을 향상시킵니다.",
        ],
        [
            "[要加载 # 条消息] → [要渲染 # 条消息]",
            "[#개 메시지 로드] → [#개 메시지 렌더링]",
        ],
        [
            "${filtered_prompts.length}/${prompts.length} 条消息",
            "${filtered_prompts.length}/${prompts.length} 메시지",
        ],
        ["备注文本", "비고 텍스트"],
        ["键名不能为空", "키 이름은 비워둘 수 없습니다"],
        ["键名已存在", "키 이름이 이미 존재합니다"],
        ["编辑成功", "편집 성공"],
        ["编辑失败", "편집 실패"],
        ["新增变量", "변수 추가"],
        ["新增变量失败", "변수 추가 실패"],
        ["删除全部", "전체 삭제"],
        ["删除成功", "삭제 성공"],
        [
            "确定要删除此变量吗？此操作不可撤销",
            "이 변수를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.",
        ],
        ["当前没有可删除的变量", "현재 삭제 가능한 변수가 없습니다"],
        ["暂无可删除的变量", "삭제할 변수가 없습니다"],
        [
            "暂无变量，点击上方“新增变量”创建",
            "변수가 없습니다. 상단의 '변수 추가'를 클릭하여 생성하세요.",
        ],
        ["已更新键名", "키 이름을 업데이트했습니다"],
        ["已清空对象", "객체를 비웠습니다"],
        ["已清空数组", "배열을 비웠습니다"],
        ["已删除变量", "변수를 삭제했습니다"],
        ["已删除全部变量", "모든 변수를 삭제했습니다"],
        ["已添加到对象", "객체에 추가했습니다"],
        ["已添加到数组", "배열에 추가했습니다"],
        ["已重置为对象", "객체로 초기화했습니다"],
        ["第 ${normalized_message_id} 楼", "${normalized_message_id}번째"],
        [
            "酒馆助手脚本-${to_export.name}.json",
            "태번 도우미 스크립트-${to_export.name}.json",
        ],
        ["重命名失败", "이름 변경 실패"],
        ["正在加载说明...", "설명 불러오는 중..."],
        ["搜索变量(支持正则表达式 )", "변수 검색 (정규식 지원)"],
        [
            "无法找到版本 '${max_version}' 的日志",
            "'${max_version}' 버전의 로그를 찾을 수 없습니다",
        ],
        [
            "无法找到版本 '${min_version}' 的日志",
            "'${min_version}' 버전의 로그를 찾을 수 없습니다",
        ],
        [
            "示例：&#10;https://example.com/audio1.mp3&#10;https://example.com/audio2.mp3,我的音乐&#10;https://example.com/audio3.mp3",
            "예시:&#10;https://example.com/audio1.mp3&#10;https://example.com/audio2.mp3,내 음악&#10;https://example.com/audio3.mp3",
        ],
        [
            "成功导入脚本 '${script_tree.name}'",
            "스크립트 '${script_tree.name}' 가져오기 성공",
        ],
        [
            "成功导入脚本: '${script.name}'",
            "스크립트 가져오기 성공: '${script.name}'",
        ],
        [
            "成功导入脚本文件夹 '${script_tree.name}'",
            "스크립트 폴더 '${script_tree.name}' 가져오기 성공",
        ],
        [
            "导入脚本文件 '${file.name}' 失败",
            "스크립트 파일 '${file.name}' 가져오기 실패",
        ],
        [
            "编写变量角色卡而非测试/游玩角色卡时，打开此开关，避免 \\{\\{get_message_variable::变量\\}\\} 等宏被替换",
            "변수용 캐릭터 카드를 작성할 때(테스트/플레이용 아님), 이 옵션을 켜면 \\{\\{get_message_variable::변수\\}\\} 같은 매크로가 치환되는 것을 방지합니다.",
        ],
        [
            "编写变量角色卡而非测试/游玩角色卡时，打开此开关，避免 \\\\{\\\\{get_message_variable::变量\\\\}\\\\} 等宏被替换",
            "변수용 캐릭터 카드를 작성할 때(테스트/플레이용 아님), 이 옵션을 켜면 \\{\\{get_message_variable::변수\\}\\} 같은 매크로가 치환되는 것을 방지합니다.",
        ],
        [
            "<div>'${script.value.name}' 脚本包含脚本变量，是否要清除？如有 API Key 等敏感数据，注意清除</div>",
            "<div>'${script.value.name}' 스크립트에 스크립트 변수가 포함되어 있습니다. 내용을 지우시겠습니까? API Key 등 민감 정보가 있다면 삭제에 주의하세요.</div>",
        ],
        [
            "<div>'${script_folder.value.name}' 文件夹中 '${JSON.stringify(scripts_with_data.map(script => script.name))}' 脚本包含脚本变量, 是否要清除? 如有 API Key 等敏感数据，注意清除</div>",
            "<div>'${script_folder.value.name}' 폴더 내 '${JSON.stringify(scripts_with_data.map(script => script.name))}' 스크립트에 스크립트 변수가 포함되어 있습니다. 내용을 지우시겠습니까? API Key 등 민감 정보가 있다면 삭제에 주의하세요.</div>",
        ],
        [
            "<div><h4>此预设包含酒馆助手可用的嵌入式脚本</h4><h4>是否现在就启用它们?</h4><small>您可以选择否, 稍后在“酒馆助手-脚本库-预设脚本”中手动启用它们</small></div>",
            '<div><h4>이 프리셋에는 태번 도우미용 내장 스크립트가 포함되어 있습니다.</h4><h4>지금 활성화하시겠습니까?</h4><small>아니요를 선택할 경우, 나중에 "태번 도우미 - 스크립트 라이브러리 - 프리셋 스크립트"에서 수동으로 활성화할 수 있습니다.</small></div>',
        ],
        [
            "<div>更新日志加载中...</div>",
            "<div>업데이트 로그 불러오는 중...</div>",
        ],
        [
            "<div>确定要删除脚本吗? 此操作无法撤销</div>",
            "<div>스크립트를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.</div>",
        ],
        [
            "<div>确定要删除文件夹及其中所有脚本吗？此操作无法撤销</div>",
            "<div>폴더와 그 안의 모든 스크립트를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.</div>",
        ],
        [
            "<div>确定要删除音频吗? 此操作无法撤销</div>",
            "<div>오디오를 삭제하시겠습니까? 이 작업은 취소할 수 없습니다.</div>",
        ],
        [
            "[酒馆助手]读取角色卡数据失败, 将使用空数据",
            "[태번 도우미] 캐릭터 카드 데이터 로드 실패. 빈 데이터를 사용합니다.",
        ],
        [
            "[酒馆助手]连接实时监听器出错, 尝试重连...",
            "[태번 도우미] 실시간 리스너 연결 오류. 재연결 시도 중...",
        ],

        // ST-Extension-Cleanup-World-Lorebook
        ["世界书大扫除🧹", "월드북 대청소🧹"],
        ["世界书统一管理家政服务", "월드북 통합 관리 도우미"],
        [
            "删除角色时删除关联的主要世界书",
            "캐릭터 삭제 시 연결된 메인 월드북도 삭제",
        ],
        [
            "删除角色时自动清理其关联的主要世界书",
            "캐릭터 삭제 시 연결된 메인 월드북 자동 정리",
        ],
        ["角色更新时替换世界书", "캐릭터 업데이트 시 월드북 교체"],
        [
            "替换/更新角色卡时，提示是否替换世界书",
            "캐릭터 카드 교체/업데이트 시 월드북 교체 여부 묻기",
        ],
        ["删除世界书前显示确认对话框", "월드북 삭제 전 확인창 표시"],
        ["执行删除操作前显示确认对话框", "삭제 실행 전 확인창 표시"],
        [
            "点击【世界书大管理】时强制加载所有角色数据",
            "[월드북 대청소] 클릭 시 모든 캐릭터 데이터 강제 로드",
        ],
        [
            "修复懒加载导致的【世界书大管理】列表显示不全（较慢）使用完退出【世界书大管理】后建议刷新浏览器，以免导致卡顿",
            "지연 로딩(Lazy Load)으로 인한 [월드북 대청소] 목록 누락 문제 해결(다소 느림). 사용 후 [월드북 대청소]를 종료하고 브라우저를 새로고침하는 것을 권장합니다.",
        ],
        [
            "重命名世界书时自动重新关联角色",
            "월드북 이름 변경 시 캐릭터 연결 자동 갱신",
        ],
        [
            "世界书被重命名时，自动更新使用该世界书的角色卡关联",
            "월드북 이름이 변경되면 해당 월드북을 사용하는 캐릭터 카드의 연결 정보를 자동 업데이트합니다.",
        ],
        ["世界书大管理！", "월드북 통합 관리!"],
        [
            "统一管理/搜索所有世界书并手动选择删除",
            "모든 월드북을 통합 관리/검색하고 수동으로 선택 삭제",
        ],
        [
            "⚠️ 删除世界书后无法恢复，请谨慎操作！",
            "⚠️ 월드북 삭제 시 복구할 수 없습니다. 신중하세요!",
        ],
        ["自动打扫设置", "자동 정리 설정"],
        ["管理工具", "관리 도구"],
        ["调试工具", "디버그 도구"],
        ["Debug! 检查当前角色", "Debug! 현재 캐릭터 확인"],
        [
            "检查当前角色的世界书数据 (查看控制台)",
            "현재 캐릭터의 월드북 데이터 확인 (콘솔)",
        ],
        [
            "检测系统懒加载状态和API功能",
            "시스템 지연 로딩 상태 및 API 기능 점검",
        ],
        [
            "全面检测扩展功能并复制错误日志",
            "확장 기능 전체 점검 및 에러 로그 복사",
        ],
        ["Debug! 测试强制加载功能", "Debug! 강제 로드 기능 테스트"],
        ["Debug! 错误检测", "Debug! 에러 진단"],
        [
            "是否同时删除这些世界书文件？",
            "이 월드북 파일들도 함께 삭제하시겠습니까?",
        ],
        ["删除这些孤立的文件？", "이 연결 끊긴 파일들을 삭제할까요?"],
        ["删除选中的文件", "선택한 파일 삭제"],
        ["取消", "취소"],
        ["未选择任何文件", "선택된 파일 없음"],
        ["删除某些世界书文件失败", "일부 월드북 파일 삭제 실패"],
        ["未发现孤立的世界书文件", "연결 끊긴 월드북 파일이 없습니다."],
        ["执行手动清理时出错", "수동 정리 중 오류 발생"],
        ["请查看控制台获取角色数据", "캐릭터 데이터는 콘솔에서 확인하세요."],
        ["未选择角色", "캐릭터가 선택되지 않음"],
        ["正在加载世界书列表...", "월드북 목록 로딩 중..."],
        ["正在预加载角色数据...", "캐릭터 데이터 미리 불러오는 중..."],
        [
            "批量编辑时预加载角色数据",
            "일괄 편집 시 캐릭터 데이터 미리 불러오기",
        ],
        [
            "进入批量编辑模式时自动预加载所有角色数据，确保删除时能检测到链接的世界书",
            "일괄 편집 모드 진입 시 모든 캐릭터 데이터를 미리 불러와, 삭제 시 연결된 월드북을 정확히 감지합니다.",
        ],
        ["预加载角色数据？", "캐릭터 데이터를 미리 불러올까요?"],
        [
            "这些世界书未关联到任何角色",
            "이 월드북들은 어떤 캐릭터와도 연결되어 있지 않습니다.",
        ],
        [
            "这些世界书正在被角色使用",
            "이 월드북들은 현재 캐릭터가 사용 중입니다.",
        ],
        ["搜索孤立世界书名称...", "연결되지 않은 월드북 이름 검색..."],
        ["搜索关键词...", "키워드 검색..."],
        ["全选本页", "현재 페이지 전체 선택"],
        ["没有发现孤立的世界书文件", "연결 끊긴 월드북 파일 없음"],
        ["没有已关联的世界书文件", "연결된 월드북 파일 없음"],
        ["关键词:", "키워드:"],
        ["显示筛选:", "필터 표시:"],
        ["文件名+角色名", "파일명+캐릭터명"],
        ["仅文件名", "파일명만"],
        ["仅角色名", "캐릭터명만"],
        ["全部", "전체"],
        ["仅作为主要世界书", "메인 월드북만"],
        ["仅作为附加世界书", "추가 월드북만"],
        ["仅全局世界书", "전역 월드북만"],
        ["世界书名称", "월드북 이름"],
        ["系统默认，不可删除", "시스템 기본값 (삭제 불가)"],
        ["关闭", "닫기"],
        ["是，替换世界书", "네, 월드북을 교체합니다"],
        ["否，保留现有设置", "아니요, 기존 설정을 유지합니다"],
        ["世界书替换", "월드북 교체"],
        ["世界书替换成功完成！", "월드북 교체 완료!"],
        ["检测世界书时出错", "월드북 검사 중 오류 발생"],
        [
            "拖拽接近列表上下边缘时自动滚动，便于把条目拖到很远的位置。",
            "항목을 드래그하여 목록의 상하 가장자리에 접근하면 자동으로 스크롤되어, 먼 위치까지 쉽게 이동할 수 있습니다.",
        ],
        [
            "仅对“原生 sortable”生效：把拖拽 helper 挂到 body，避免被列表 overflow 裁剪。",
            "'기본 Sortable' 모드에서만 적용: 드래그 헬퍼를 body에 배치하여 목록 프레임에 의해 항목이 잘리는 현상을 방지합니다.",
        ],
    ]);

    const REGEX_RULES = [
        {
            re: /^子面板渲染失败：(.+)（请看控制台）$/,
            replace: "서브패널 렌더링 실패: $1 (콘솔 확인)",
        },
        {
            re: /^当前版本[:：]\s*(.*?)\s*最新版本[:：]\s*(.*?)\s*是否现在更新[？?]?$/,
            replace: "현재 버전: $1\n최신 버전: $2\n지금 업데이트하시겠습니까?",
        },
        { re: /^当前版本[:：](.+)$/, replace: "현재 버전: $1" },
        { re: /^最新版本[:：](.+)$/, replace: "최신 버전: $1" },
        { re: /^最新: Ver (.+)$/, replace: "최신: Ver $1" },
        {
            re: /^确定要移动选中的 (\d+) 个脚本吗？$/,
            replace: "선택한 $1개 스크립트를 이동하시겠습니까?",
        },
        {
            re: /^确定要删除选中的 (\d+) 个脚本吗？$/,
            replace: "선택한 $1개 스크립트를 삭제하시겠습니까?",
        },

        // ST-Extension-Cleanup-World-Lorebook dynamic strings
        {
            re: /^共找到\s*(\d+)\s*个世界书文件\s*\(含\s*(\d+)\s*个全局\)\s*$/,
            replace: "총 $1개의 월드북 파일 발견 (전역 $2개 포함)",
        },
        {
            re: /^共找到\s*(\d+)\s*个世界书文件\s*$/,
            replace: "총 $1개의 월드북 파일 발견",
        },
        {
            re: /^(?:🗑️?|🗑)?\s*孤立\s*[（(]\s*(\d+)\s*[）)]\s*$/,
            replace: "🗑️ 연결안됨 ($1)",
        },
        {
            re: /^(?:🔗)?\s*关联\s*[（(]\s*(\d+)\s*[）)]\s*$/,
            replace: "🔗 연결됨 ($1)",
        },
        {
            re: /孤立\s*[（(]\s*(\d+)\s*[）)]/,
            replace: "연결안됨 ($1)",
        },
        {
            re: /关联\s*[（(]\s*(\d+)\s*[）)]/,
            replace: "연결됨 ($1)",
        },
        {
            re: /^发现 (\d+) 个关联的世界书文件：$/,
            replace: "연결된 월드북 파일 $1개 발견:",
        },
        {
            re: /^发现 (\d+) 个孤立的世界书文件：$/,
            replace: "연결되지 않은 월드북 파일 $1개 발견:",
        },
        {
            re: /^确定要删除选中的 (\d+) 个世界书吗？$/,
            replace: "선택한 $1개 월드북을 삭제하시겠습니까?",
        },
        {
            re: /^已删除 (\d+) 个世界书文件$/,
            replace: "$1개 월드북 파일을 삭제했습니다.",
        },
        {
            re: /^已加载 (\d+) \/ (\d+) 个角色$/,
            replace: "$1 / $2 캐릭터 로드 완료",
        },
        {
            re: /^已加载: (\d+) \/ (\d+) 个角色$/,
            replace: "로드됨: $1 / $2 캐릭터",
        },
        {
            re: /^成功预加载 (\d+) 个角色数据$/,
            replace: "$1개 캐릭터 데이터 사전 로드 성공",
        },
        {
            re: /^预加载完成，但有 (\d+) 个角色加载失败$/,
            replace: "사전 로드 완료 (실패한 캐릭터: $1개)",
        },
        {
            re: /^成功加载 (\d+) 个角色的完整数据$/,
            replace: "$1개 캐릭터의 전체 데이터 로드 성공",
        },
        {
            re: /^无法删除 (\d+) 个世界书文件。请手动检查并删除：(.+)$/,
            replace:
                "$1개 월드북 파일을 삭제하지 못했습니다. 수동으로 확인 후 삭제하세요: $2",
        },
        {
            re: /^已更新 (\d+) 个世界书关联$/,
            replace: "$1개 월드북 연결을 업데이트했습니다.",
        },
        {
            re: /^世界书 \"(.+)\" 还被其他 (\d+) 个角色使用。$/,
            replace: '월드북 "$1"은(는) 다른 $2개 캐릭터가 사용 중입니다.',
        },
        {
            re: /^(?:🗑️?|🗑)?\s*孤立文件[:：]\s*(\d+)\s*个\s*$/,
            replace: "🗑️ 연결되지 않은 파일: $1개",
        },
        {
            re: /^\s*📋\s*点击查看文件列表\s*[（(]\s*(\d+)\s*[）)]\s*$/,
            replace: "📋 파일 목록 보기 ($1)",
        },
        { re: /^\s*孤立文件[:：]?\s*$/, replace: "연결되지 않은 파일:" },
        { re: /^\s*关联文件[:：]?\s*$/, replace: "연결된 파일:" },
    ];

    const ATTR_NAMES = ["title", "placeholder", "aria-label"];

    const SKIP_SELECTORS = [
        "script",
        "style",
        "code",
        "pre",
        "textarea",
        '[contenteditable="true"]',
        ".mes",
        ".mes_text",
        ".mes_block",
        "#chat",
        ".swipe_right",
        ".swipe_left",
    ].join(",");

    function hasChinese(str) {
        return /[\u3400-\u9FFF]/.test(str);
    }

    function shouldTranslateElement(el) {
        if (!(el instanceof Element)) return false;
        if (el.closest(SKIP_SELECTORS)) return false;
        return true;
    }

    function translateString(input) {
        if (typeof input !== "string" || input.length === 0) return input;

        // Dynamic update popup text:
        // 当前版本: X / 最新版本: Y / 是否现在更新？
        // Keep variable values as-is, replace labels only.
        if (
            input.includes("当前版本") &&
            input.includes("最新版本") &&
            input.includes("是否现在更新")
        ) {
            return input
                .replace(/当前版本[:：]\s*/g, "현재 버전: ")
                .replace(/最新版本[:：]\s*/g, "최신 버전: ")
                .replace(/是否现在更新[？?]?/g, "지금 업데이트하시겠습니까?");
        }

        const exact = input.match(/^(\s*)([\s\S]*?)(\s*)$/);
        if (exact) {
            const core = exact[2];
            const coreTrimmed = core.trim();
            const translated =
                OVERRIDE_MAP.get(core) ||
                OVERRIDE_MAP.get(coreTrimmed) ||
                EXACT_MAP.get(core) ||
                EXACT_MAP.get(coreTrimmed);
            if (translated) return exact[1] + translated + exact[3];
        }

        for (const rule of REGEX_RULES) {
            if (rule.re.test(input))
                return input.replace(rule.re, rule.replace);
        }

        return input;
    }

    function translateTextNode(textNode) {
        if (!(textNode instanceof Text)) return;
        const parent = textNode.parentElement;
        if (!parent || !shouldTranslateElement(parent)) return;

        const before = textNode.nodeValue;
        if (!before || !hasChinese(before)) return;

        const after = translateString(before);
        if (after !== before) textNode.nodeValue = after;
    }

    function translateAttributes(el) {
        if (!shouldTranslateElement(el)) return;

        for (const attr of ATTR_NAMES) {
            const before = el.getAttribute(attr);
            if (!before || !hasChinese(before)) continue;
            const after = translateString(before);
            if (after !== before) el.setAttribute(attr, after);
        }

        if (el instanceof HTMLInputElement) {
            const type = (el.getAttribute("type") || "").toLowerCase();
            if (type === "button" || type === "submit" || type === "reset") {
                const before = el.value;
                if (before && hasChinese(before)) {
                    const after = translateString(before);
                    if (after !== before) el.value = after;
                }
            }
        }
    }

    function translateTree(root) {
        if (!root) return;

        if (root instanceof Text) {
            translateTextNode(root);
            return;
        }

        if (
            !(root instanceof Element) &&
            !(root instanceof DocumentFragment) &&
            !(root instanceof Document)
        )
            return;

        if (root instanceof Element) {
            translateAttributes(root);
            for (const child of root.childNodes) {
                if (child.nodeType === Node.TEXT_NODE) translateTextNode(child);
            }
        }

        const walker = document.createTreeWalker(
            root,
            NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT,
        );
        while (walker.nextNode()) {
            const node = walker.currentNode;
            if (node.nodeType === Node.TEXT_NODE) translateTextNode(node);
            else if (node.nodeType === Node.ELEMENT_NODE)
                translateAttributes(node);
        }
    }

    function startObserver() {
        const observer = new MutationObserver((mutations) => {
            for (const m of mutations) {
                if (m.type === "characterData") {
                    translateTree(m.target);
                    continue;
                }
                if (m.type === "childList") {
                    for (const node of m.addedNodes) translateTree(node);
                }
                if (m.type === "attributes" && m.target instanceof Element) {
                    translateAttributes(m.target);
                }
            }
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true,
            characterData: true,
            attributes: true,
            attributeFilter: [...ATTR_NAMES, "value"],
        });

        setInterval(() => {
            try {
                translateTree(document.body);
            } catch {}
        }, 2000);
    }

    function init() {
        if (!document.body) return;
        translateTree(document.body);
        startObserver();
        console.debug(`[${EXTENSION_NAME}] loaded (static dictionary only)`);
    }

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", init, { once: true });
    } else {
        init();
    }
})();
